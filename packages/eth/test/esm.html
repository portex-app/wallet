<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portex ETH é’±åŒ… ESM æµ‹è¯•</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }

      .section {
        margin: 20px 0;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background-color: #fafafa;
      }

      .button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .status {
        padding: 10px;
        border-radius: 6px;
        margin: 10px 0;
        font-weight: bold;
      }

      .status.connected {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status.disconnected {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }

      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        padding: 15px;
        border-radius: 6px;
        margin: 15px 0;
      }

      input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin: 5px 0;
        box-sizing: border-box;
      }

      label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
        color: #555;
      }

      .code-block {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        overflow-x: auto;
        margin: 10px 0;
      }

      .wallet-info {
        margin: 10px 0;
        padding: 10px;
        background-color: #e8f4fd;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
      }

      .network-selector {
        margin: 10px 0;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 4px;
      }

      .network-form {
        margin-top: 15px;
        padding: 15px;
        background-color: #fff;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
      }

      .network-form input {
        margin-bottom: 10px;
      }

      .network-form label {
        display: block;
        margin-bottom: 5px;
        color: #666;
      }

      .network-form .form-group {
        margin-bottom: 15px;
      }

      .network-form .form-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }

      .network-form .form-row input {
        flex: 1;
      }

      .network-info {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 10px 0;
      }

      .network-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }

      .network-badge.mainnet {
        background-color: #28a745;
        color: white;
      }

      .network-badge.testnet {
        background-color: #ffc107;
        color: black;
      }

      .network-switch {
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸš€ Portex ETH é’±åŒ… ESM æµ‹è¯•é¡µé¢</h1>

      <div class="info">
        <strong>è¯´æ˜ï¼š</strong> è¿™ä¸ªé¡µé¢æ¼”ç¤ºäº†å¦‚ä½•åœ¨HTMLä¸­ä½¿ç”¨Portex ETHé’±åŒ…SDKçš„ESMç‰ˆæœ¬ã€‚è¯·ç¡®ä¿ä½ å·²ç»æ„å»ºäº†é¡¹ç›®å¹¶ä¸”distæ–‡ä»¶å­˜åœ¨ã€‚
      </div>

      <div class="section">
        <h3>ğŸ“Š é’±åŒ…çŠ¶æ€</h3>
        <div id="walletStatus" class="status disconnected">æœªè¿æ¥</div>
        <div id="walletInfo" class="wallet-info"></div>
      </div>

      <div class="section">
        <h3>ğŸ”Œ é’±åŒ…è¿æ¥</h3>
        <button class="button" id="connectBtn">è¿æ¥é’±åŒ…</button>
        <button class="button" id="disconnectBtn" disabled>æ–­å¼€è¿æ¥</button>
        <button class="button" id="getAccountBtn">è·å–è´¦æˆ·ä¿¡æ¯</button>
      </div>
      <div class="section">
        <h3>ğŸŒ ç½‘ç»œæ§åˆ¶</h3>
        <div class="network-info">
          <span>å½“å‰ç½‘ç»œï¼š</span>
          <span id="networkBadge" class="network-badge">æœªè¿æ¥</span>
          <span id="networkId"></span>
        </div>
        <button class="button" id="getNetworkInfoBtn">è·å–å½“å‰ç½‘ç»œä¿¡æ¯</button>

        <div class="network-switch">
          <h4>å¿«é€Ÿåˆ‡æ¢ç½‘ç»œ</h4>
          <div class="form-group">
            <label for="switchChainId">Chain ID:</label>
            <input type="text" id="switchChainId" placeholder="ä¾‹å¦‚: 0x1 æˆ– 1" />
          </div>
          <button class="button" id="switchToCustomNetwork">åˆ‡æ¢åˆ°æŒ‡å®šç½‘ç»œ</button>
        </div>

        <div class="network-form">
          <h4>æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œ</h4>
          <div class="form-group">
            <label for="chainId">Chain ID:</label>
            <input type="number" id="chainId" placeholder="ä¾‹å¦‚: 1" />
          </div>

          <div class="form-group">
            <label for="chainName">ç½‘ç»œåç§°:</label>
            <input type="text" id="chainName" placeholder="ä¾‹å¦‚: Ethereum Mainnet" />
          </div>

          <div class="form-group">
            <label>åŸç”Ÿè´§å¸:</label>
            <div class="form-row">
              <input type="text" id="currencyName" placeholder="è´§å¸åç§°" />
              <input type="text" id="currencySymbol" placeholder="è´§å¸ç¬¦å·" />
              <input type="number" id="currencyDecimals" placeholder="å°æ•°ä½" value="18" />
            </div>
          </div>

          <div class="form-group">
            <label for="rpcUrl">RPC URL:</label>
            <input type="text" id="rpcUrl" placeholder="ä¾‹å¦‚: https://mainnet.infura.io/v3/YOUR-PROJECT-ID" />
          </div>

          <div class="form-group">
            <label for="blockExplorerUrl">åŒºå—æµè§ˆå™¨ URL:</label>
            <input type="text" id="blockExplorerUrl" placeholder="ä¾‹å¦‚: https://etherscan.io" />
          </div>

          <div class="button-group">
            <button class="button" id="addCustomNetwork">æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œ</button>
          </div>
        </div>
      </div>
      <div class="section">
        <h3>ğŸ’¸ å‘é€äº¤æ˜“</h3>
        <label for="toAddress">æ¥æ”¶åœ°å€:</label>
        <input type="text" id="toAddress" placeholder="0x..." />

        <label for="amount">é‡‘é¢ (ETH):</label>
        <input type="text" id="amount" placeholder="0.01" value="0.01" />

        <button class="button" id="sendBtn" disabled>å‘é€äº¤æ˜“</button>
      </div>

      <div class="section">
        <h3>ğŸ“‹ æ—¥å¿—</h3>
        <div id="logs" class="code-block"></div>
        <button class="button" id="clearLogsBtn">æ¸…ç©ºæ—¥å¿—</button>
      </div>
    </div>

    <script type="module">
      import { Wallet } from '../dist/index.mjs';

      let wallet = null;

      function log(message, type = 'info') {
        const logs = document.getElementById('logs');
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}\n`;
        logs.textContent += logEntry;
        logs.scrollTop = logs.scrollHeight;

        console.log(message);

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        if (type === 'error') {
          showError(message);
        }
      }

      function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error';
        errorDiv.textContent = message;
        document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.section'));
        setTimeout(() => errorDiv.remove(), 5000);
      }

      function updateWalletStatus(connected) {
        const status = document.getElementById('walletStatus');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const sendBtn = document.getElementById('sendBtn');

        if (connected) {
          status.textContent = 'å·²è¿æ¥';
          status.className = 'status connected';
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
          sendBtn.disabled = false;
        } else {
          status.textContent = 'æœªè¿æ¥';
          status.className = 'status disconnected';
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
          sendBtn.disabled = true;
        }
      }

      function updateWalletInfo(account) {
        const info = document.getElementById('walletInfo');
        if (account) {
          info.textContent = `åœ°å€: ${account.address}`;
        } else {
          info.textContent = '';
        }
      }

      function updateNetworkInfo(network) {
        const networkBadge = document.getElementById('networkBadge');
        const networkId = document.getElementById('networkId');

        if (network) {
          networkBadge.textContent = `Chain ID: ${network.chainId}`;
          networkBadge.className = 'network-badge';
          networkId.textContent = '';
        } else {
          networkBadge.textContent = 'æœªè¿æ¥';
          networkBadge.className = 'network-badge';
          networkId.textContent = '';
        }
      }

      // åˆå§‹åŒ–
      async function init() {
        try {
          wallet = Wallet.getInstance();
          log('é’±åŒ…å®ä¾‹å·²åˆå§‹åŒ–');

          // æ·»åŠ çŠ¶æ€å˜åŒ–ç›‘å¬
          wallet.addStatusChangeListener((status, account) => {
            updateWalletStatus(status === 'connected');
            updateWalletInfo(account);
            log(`é’±åŒ…çŠ¶æ€å˜åŒ–: ${status},${JSON.stringify(account)}`);
          });

          console.log(wallet.connected);
          // æ£€æŸ¥åˆå§‹çŠ¶æ€
          if (wallet.status) {
            updateWalletStatus(true);
            updateWalletInfo(wallet.account);
            const networkInfo = await wallet.getNetworkInfo();
            console.log(networkInfo);
            updateNetworkInfo(networkInfo);
          }
        } catch (error) {
          log(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
        }
      }

      // äº‹ä»¶ç›‘å¬
      document.getElementById('connectBtn').addEventListener('click', async () => {
        try {
          await wallet.connect();
          log('é’±åŒ…è¿æ¥æˆåŠŸ');
        } catch (error) {
          log(`è¿æ¥å¤±è´¥: ${error.message}`, 'error');
        }
      });

      document.getElementById('disconnectBtn').addEventListener('click', async () => {
        try {
          await wallet.disconnect();
          log('é’±åŒ…å·²æ–­å¼€è¿æ¥');
        } catch (error) {
          log(`æ–­å¼€è¿æ¥å¤±è´¥: ${error.message}`, 'error');
        }
      });

      document.getElementById('getAccountBtn').addEventListener('click', () => {
        if (wallet.account) {
          log(`å½“å‰è´¦æˆ·: ${wallet.account.address}`);
        } else {
          log('æœªè¿æ¥é’±åŒ…', 'error');
        }
      });

      document.getElementById('sendBtn').addEventListener('click', async () => {
        const toAddress = document.getElementById('toAddress').value;
        const amount = document.getElementById('amount').value;

        if (!toAddress || !amount) {
          log('è¯·å¡«å†™æ¥æ”¶åœ°å€å’Œé‡‘é¢', 'error');
          return;
        }

        try {
          const txHash = await wallet.sendTransaction(toAddress, amount);
          log(`äº¤æ˜“å·²å‘é€ï¼Œå“ˆå¸Œ: ${txHash}`);
        } catch (error) {
          log(`å‘é€äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
        }
      });

      document.getElementById('clearLogsBtn').addEventListener('click', () => {
        document.getElementById('logs').textContent = '';
      });

      // è·å–è‡ªå®šä¹‰ç½‘ç»œé…ç½®
      function getCustomNetworkConfig() {
        const chainId = parseInt(document.getElementById('chainId').value);
        const chainName = document.getElementById('chainName').value;
        const rpcUrl = document.getElementById('rpcUrl').value;
        const blockExplorerUrl = document.getElementById('blockExplorerUrl').value;
        const currencyName = document.getElementById('currencyName').value;
        const currencySymbol = document.getElementById('currencySymbol').value;
        const currencyDecimals = parseInt(document.getElementById('currencyDecimals').value);

        if (!chainId || !chainName || !rpcUrl) {
          throw new Error('è¯·å¡«å†™å¿…è¦çš„ç½‘ç»œä¿¡æ¯ï¼ˆChain IDã€ç½‘ç»œåç§°å’Œ RPC URLï¼‰');
        }

        return {
          chainId,
          chainName,
          rpcUrl,
          blockExplorerUrl,
          nativeCurrency: {
            name: currencyName,
            symbol: currencySymbol,
            decimals: currencyDecimals
          }
        };
      }

      // æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œ
      document.getElementById('addCustomNetwork').addEventListener('click', async () => {
        try {
          const networkConfig = getCustomNetworkConfig();
          log(`æ­£åœ¨æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œï¼š${JSON.stringify(networkConfig)}`);

          await wallet.switchToCustomNetwork(networkConfig.chainId, {
            chainName: networkConfig.chainName,
            nativeCurrency: networkConfig.nativeCurrency,
            rpcUrls: [networkConfig.rpcUrl],
            blockExplorerUrls: networkConfig.blockExplorerUrl ? [networkConfig.blockExplorerUrl] : undefined
          });

          log(`è‡ªå®šä¹‰ç½‘ç»œæ·»åŠ æˆåŠŸ: ${networkConfig.chainName} (Chain ID: ${networkConfig.chainId})`);
        } catch (error) {
          log(`æ·»åŠ ç½‘ç»œå¤±è´¥: ${error.message}`, 'error');
        }
      });

      // åˆ‡æ¢åˆ°è‡ªå®šä¹‰ç½‘ç»œ
      document.getElementById('switchToCustomNetwork').addEventListener('click', async () => {
        try {
          const chainId = document.getElementById('switchChainId').value;
          if (!chainId) {
            throw new Error('è¯·è¾“å…¥ Chain ID');
          }

          log(`æ­£åœ¨åˆ‡æ¢åˆ°ç½‘ç»œï¼ŒChain ID: ${chainId}`);
          await wallet.switchNetwork(chainId);
          log(`å·²åˆ‡æ¢åˆ°ç½‘ç»œï¼ŒChain ID: ${chainId}`);
        } catch (error) {
          log(`åˆ‡æ¢ç½‘ç»œå¤±è´¥: ${error.message}`, 'error');
        }
      });

      // æ·»åŠ è·å–ç½‘ç»œä¿¡æ¯æŒ‰é’®äº‹ä»¶
      document.getElementById('getNetworkInfoBtn').addEventListener('click', async () => {
        try {
          const networkInfo = await wallet.getNetworkInfo();
          log(`å½“å‰ç½‘ç»œä¿¡æ¯ï¼šChain ID: ${networkInfo.chainId}, ç½‘ç»œåç§°: ${networkInfo.chainName || 'æœªçŸ¥'}`);

          // æ›´æ–°ç½‘ç»œä¿¡æ¯æ˜¾ç¤º
          const networkBadge = document.getElementById('networkBadge');
          const networkId = document.getElementById('networkId');
          networkBadge.textContent = `Chain ID: ${networkInfo.chainId}`;
          if (networkInfo.chainName) {
            networkId.textContent = `(${networkInfo.chainName})`;
          }
        } catch (error) {
          log(`è·å–ç½‘ç»œä¿¡æ¯å¤±è´¥: ${error.message}`, 'error');
        }
      });

      // è®¾ç½®è‡ªå®šä¹‰ç½‘ç»œè¡¨å•çš„åˆå§‹å€¼
      document.getElementById('chainId').value = '36888';
      document.getElementById('chainName').value = 'AB Core';
      document.getElementById('rpcUrl').value = 'https://rpc.core.ab.org';
      document.getElementById('blockExplorerUrl').value = 'https://explorer.core.ab.org';
      document.getElementById('currencyName').value = 'AB';
      document.getElementById('currencySymbol').value = 'AB';
      document.getElementById('currencyDecimals').value = '18';

      // å¯åŠ¨åº”ç”¨
      init();
    </script>
  </body>
</html>
